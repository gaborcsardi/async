<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Asynchronous Computation and I/O â€¢ async</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="bootstrap-toc.css">
<script src="bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="pkgdown.css" rel="stylesheet">
<script src="pkgdown.js"></script><meta property="og:title" content="Asynchronous Computation and I/O">
<meta property="og:description" content="The async package brings asynchronous (async) computation
    and I/O to R. It uses an event loop to schedule asynchronous
    functions that report their results via deferred values. Deferred
    values can be chained together for complex async computation, and they
    are evaluated lazily, at synchronisation points.">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-home">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="index.html">async</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.0.0.9004</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="articles/async-example.html">Examples for the async package</a>
    </li>
    <li>
      <a href="articles/internals.html">Internals of the async package</a>
    </li>
  </ul>
</li>
<li>
  <a href="news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/gaborcsardi/async/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="contents col-md-9">
<div class="section level1">
<div class="page-header"><h1 id="async">async<a class="anchor" aria-label="anchor" href="#async"></a>
</h1></div>
<blockquote>
<p>Asynchronous HTTP</p>
</blockquote>
<!-- badges: start -->

<p>The async package brings asynchronous (async) computation and I/O to R. It uses an event loop to schedule asynchronous functions that report their results via deferred values. Deferred values can be chained together for complex async computation, and they are evaluated lazily, at synchronisation points.</p>
<div class="section level2">
<h2 id="features">Features<a class="anchor" aria-label="anchor" href="#features"></a>
</h2>
<ul>
<li>A <code>deferred</code> class which is the basic building block for async computation.</li>
<li>Timers, HTTP queries, generic external processes, external R processes.</li>
<li>A worker pool for calling R functions in the background.</li>
<li>Operations to combine deferred values: <code>$then()</code>, <code>$when_all()</code>, <code><a href="reference/when_some.html">when_any()</a></code>, <code><a href="reference/when_some.html">when_some()</a></code>, <code>$finally()</code> and the <code>$catch()</code> operation to handle errors.</li>
<li>A strong ownership model: each deferred value has exactly one child that receives the result (or error) of its async computation.</li>
<li>Synchronisation (sync) points to embed async code into synchronous code. Sync points run their own event loop, and they can be stacked.</li>
<li>Lazy evaluation of deferred values. Only the deferred values that are needed to calculate the result of the async phase are evaluated.</li>
<li>Auto-cancellation. Deferred values that are not needed for the final result(s) of the async phase are automatically cancelled, as soon as possible.</li>
<li>Manual cancellation is also possible.</li>
<li>Progress bar support. Deferred values can report their progress via a callback function.</li>
<li>Additional helper functions for working with deferred values, e.g. <code><a href="reference/async_map.html">async_map()</a></code>, <code><a href="reference/async_detect.html">async_detect()</a></code>, <code><a href="reference/async_filter.html">async_filter()</a></code>, etc.</li>
</ul>
</div>
<div class="section level2">
<h2 id="supported-async-io-and-computation">Supported async I/O and computation<a class="anchor" aria-label="anchor" href="#supported-async-io-and-computation"></a>
</h2>
<p>We support the following async primitives: - Timers: <code><a href="reference/delay.html">delay()</a></code>. - HTTP queries: <code><a href="reference/http_get.html">http_get()</a></code>, <code><a href="reference/http_head.html">http_head()</a></code>. - External processes: <code><a href="reference/run_process.html">run_process()</a></code>. - External R processes: <code><a href="reference/run_r_process.html">run_r_process()</a></code>. - A workers pool of processes to evaluate R code: <code><a href="reference/call_function.html">call_function()</a></code>.</p>
</div>
<div class="section level2">
<h2 id="installation">Installation<a class="anchor" aria-label="anchor" href="#installation"></a>
</h2>
<p>Once on CRAN, install the package as usual:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"async"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>The async package brings asychronous I/O and computation to R. It implements asynchronous HTTP requests, timers, subprocesses and an R worker pool.</p>
</div>
<div class="section level2">
<h2 id="deferred-values">Deferred Values<a class="anchor" aria-label="anchor" href="#deferred-values"></a>
</h2>
<p>Asynchronous computation is represented by deferred values. In async a deferred value is an <a href="https://github.com/wch/R6" class="external-link">R6</a> object, so it has reference semantics. In some other programming languages deferred values are called futures or promises.</p>
<p>You can think of a deferred value as a placeholder for a (non-deferred) value that is not yet known. When the actual value of a deferred is computed, we say that the deferred is resolved.</p>
<p>Typically a deferred value is created by requesting asynchronous I/O, like an HTTP GET request with the <code><a href="reference/http_get.html">http_get()</a></code> function.</p>
</div>
<div class="section level2">
<h2 id="built-in-deferred-value-constructors">Built-in Deferred Value Constructors<a class="anchor" aria-label="anchor" href="#built-in-deferred-value-constructors"></a>
</h2>
<p>The async package has built-in async functions that create deferred values: - <code><a href="reference/delay.html">delay()</a></code> creates a timer that expires after the specified time. - <code><a href="reference/http_get.html">http_get()</a></code> and <code><a href="reference/http_head.html">http_head()</a></code> perform HTTP requests, asynchronously. - <code><a href="reference/async_constant.html">async_constant()</a></code> creates a simple deferred that represents the supplied value. - <code><a href="reference/run_process.html">run_process()</a></code> runs an external process using processx and returns its exit code, standard output and error, asynchronously. - <code><a href="reference/run_r_process.html">run_r_process()</a></code> runs an external R process, and calls the specified R function in this process. It returns its exit status, standard output, standard error, and the return value of the R function call, asynchronously. - <code><a href="reference/call_function.html">call_function()</a></code> uses a worker pool of persistent external R processes to call R functions. It returns the return value of the function, and the standard output and error of the process, asynchronously.</p>
</div>
<div class="section level2">
<h2 id="deferred-chains">Deferred chains<a class="anchor" aria-label="anchor" href="#deferred-chains"></a>
</h2>
<p>While the actual value of a deferred cannot be queried directly, we can still operate on it, by declaring code that is to be executed, once the value will be known:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/gaborcsardi/async#readme" class="external-link">async</a></span><span class="op">)</span></span>
<span><span class="va">http_status</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">url</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">def</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/http_get.html">http_get</a></span><span class="op">(</span><span class="va">url</span><span class="op">)</span><span class="op">$</span></span>
<span>    <span class="fu">then</span><span class="op">(</span><span class="kw">function</span><span class="op">(</span><span class="va">response</span><span class="op">)</span> <span class="va">response</span><span class="op">$</span><span class="va">status_code</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="fu"><a href="reference/synchronise.html">synchronise</a></span><span class="op">(</span><span class="fu">http_status</span><span class="op">(</span><span class="st">"https://httpbin.org"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb3"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] 200</span></span></code></pre></div>
<p><code>http_status()</code> is an async function that returns the status code of a GET HTTP request to the specified URL. It works by creating an async GET request and then specifying that once the HTTP response in, the status code should be accepted from it. The deferred value returned by <code>http_status()</code> resolves to the status code of the URL.</p>
<p><code>then()</code> returns another deferred, which also has a <code>then()</code> method, so it is chainable.</p>
<p><code>$then()</code> is the simplest combination operator on deferred values.</p>
<p><code>$when_all()</code> is similar, but it creates a deferred value that resolves once all deferred values passed to <code>$when_all()</code> are computed.</p>
<p><code>$when_any()</code> creates a deferred value that resolves as soon as one of its arguments successfully resolves. <code><a href="reference/when_some.html">when_some()</a></code> is its generalization that requires the computation of a given number of deferred values.</p>
</div>
<div class="section level2">
<h2 id="synchronization-barriers">Synchronization barriers<a class="anchor" aria-label="anchor" href="#synchronization-barriers"></a>
</h2>
<p>async allows embedding asynchronous computation in synchronous code. The execution of such a program has a sync phase and async phases. When the program starts, it is in the sync phase. In the sync phase you cannot create deferred values. (But you can still define (async) functions, that will create deferred values when called.)</p>
<p>To enter into an async phase, call <code><a href="reference/synchronise.html">synchronise()</a></code> on an expression that evaluates to a deferred value. The async phase will last until this deferred value is computed or an error is thrown (and the error reaches <code><a href="reference/synchronise.html">synchronise()</a></code>).</p>
<p><code><a href="reference/synchronise.html">synchronise()</a></code> creates an event loop, which manages the computation of the deferred values in this particular async phase.</p>
<p>Async phases can be embedded into each other. I.e. a program may call <code><a href="reference/synchronise.html">synchronise()</a></code> while in the async phase. The outer async phaseâ€™s event loop then stops until the inner async phase terminates. Deferred values cannot be passed through a <code><a href="reference/synchronise.html">synchronise()</a></code> barrier, to anoter (sync or async phase). Should this happen, an error is reported on the first operation on the leaked deferred value.</p>
<p>In a typical application, a function is implemented asynchronously, and then used synchronously by the interactive user, or another piece of synchronous code, via <code><a href="reference/synchronise.html">synchronise()</a></code> calls. The following example makes three HTTP requests in parallel:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">http_status3</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">http_status</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">url</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="reference/http_get.html">http_get</a></span><span class="op">(</span><span class="va">url</span><span class="op">)</span><span class="op">$</span><span class="fu">then</span><span class="op">(</span><span class="kw">function</span><span class="op">(</span><span class="va">response</span><span class="op">)</span> <span class="va">response</span><span class="op">$</span><span class="va">status_code</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="va">r1</span> <span class="op">&lt;-</span> <span class="fu">http_status</span><span class="op">(</span><span class="st">"https://httpbin.org/status/403"</span><span class="op">)</span></span>
<span>  <span class="va">r2</span> <span class="op">&lt;-</span> <span class="fu">http_status</span><span class="op">(</span><span class="st">"https://httpbin.org/status/404"</span><span class="op">)</span></span>
<span>  <span class="va">r3</span> <span class="op">&lt;-</span> <span class="fu">http_status</span><span class="op">(</span><span class="st">"https://httpbin.org/status/200"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="reference/when_all.html">when_all</a></span><span class="op">(</span><span class="va">r1</span>, <span class="va">r2</span>, <span class="va">r3</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="fu"><a href="reference/synchronise.html">synchronise</a></span><span class="op">(</span><span class="fu">http_status3</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb5"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [[1]]</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] 403</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [[2]]</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] 404</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [[3]]</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] 200</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="error-handling">Error handling<a class="anchor" aria-label="anchor" href="#error-handling"></a>
</h2>
<p>There are two ways to handle errors in asynchronous code. One is the <code>$catch()</code> operation that can be called on a deferred value. <code>$catch()</code> has similar syntax as <code><a href="https://rdrr.io/r/base/conditions.html" class="external-link">tryCatch()</a></code>. It can be used to catch errors during the computation of the deferred value, including computation in its ancestors (except for the errors the ancestors already handle).</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">response_time</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/async.html">async</a></span><span class="op">(</span><span class="kw">function</span><span class="op">(</span><span class="va">url</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="reference/http_head.html">http_head</a></span><span class="op">(</span><span class="va">url</span><span class="op">)</span><span class="op">$</span></span>
<span>    <span class="fu">then</span><span class="op">(</span><span class="va">http_stop_for_status</span><span class="op">)</span><span class="op">$</span></span>
<span>    <span class="fu">then</span><span class="op">(</span><span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/stats/setNames.html" class="external-link">setNames</a></span><span class="op">(</span><span class="va">x</span><span class="op">[[</span><span class="st">"times"</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="st">"total"</span><span class="op">]</span><span class="op">]</span>, <span class="va">url</span><span class="op">)</span><span class="op">)</span><span class="op">$</span></span>
<span>    <span class="fu">catch</span><span class="op">(</span>error <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">...</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/stats/setNames.html" class="external-link">setNames</a></span><span class="op">(</span><span class="cn">Inf</span>, <span class="va">url</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span><span class="fu"><a href="reference/synchronise.html">synchronise</a></span><span class="op">(</span><span class="fu">response_time</span><span class="op">(</span><span class="st">"https://google.com"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb7"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; https://google.com </span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;           0.213394</span></span></code></pre></div>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="reference/synchronise.html">synchronise</a></span><span class="op">(</span><span class="fu">response_time</span><span class="op">(</span><span class="st">"https://httpbin.org/status/401"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb9"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; https://httpbin.org/status/401 </span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;                            Inf</span></span></code></pre></div>
<p>Errors can also be handled synchronously. If an error is not handled asynchronously, then the deferred value will throw an error when itself or one of its descendants is <code><a href="reference/synchronise.html">synchronise()</a></code>-ed.Â This can be caught with <code><a href="https://rdrr.io/r/base/conditions.html" class="external-link">tryCatch()</a></code>.</p>
</div>
<div class="section level2">
<h2 id="ownership-and-the-async-dag">Ownership and the Async DAG<a class="anchor" aria-label="anchor" href="#ownership-and-the-async-dag"></a>
</h2>
<p>When the <code>$then()</code> method of a deferred value is called to create another deferred value:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">d2</span> <span class="op">&lt;-</span> <span class="va">d1</span><span class="op">$</span><span class="fu">then</span><span class="op">(</span><span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="va">...</span><span class="op">)</span></span></code></pre></div>
<p>then we say that <code>d2</code> owns <code>d1</code>. We also say that <code>d2</code> is the child of <code>d1</code>, and <code>d1</code> is the parent of <code>d2</code>. async has a strong ownership model, and it only allows a single owner (i.e.Â a single child) for each deferred. The parent-child relationships define a directed forest graph, a collection of directed trees. (This is without shared deferred values, see the manual.)</p>
<p>The strong ownership model does not allow calling <code>$then()</code> multiple times on the same deferred value, i.e.Â the following generates an error:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">do</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">d</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/delay.html">delay</a></span><span class="op">(</span><span class="fl">1</span><span class="op">/</span><span class="fl">100</span><span class="op">)</span></span>
<span>  <span class="va">d</span><span class="op">$</span><span class="fu">then</span><span class="op">(</span><span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="st">"foo"</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">d</span><span class="op">$</span><span class="fu">then</span><span class="op">(</span><span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="st">"bar"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="fu"><a href="reference/synchronise.html">synchronise</a></span><span class="op">(</span><span class="fu">do</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb12"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Error in def__add_as_parent(self, private, child): Deferred value is already owned</span></span></code></pre></div>
<p>The <code><a href="reference/when_all.html">when_all()</a></code>, <code><a href="reference/when_some.html">when_any()</a></code> and <code><a href="reference/when_some.html">when_some()</a></code> operations set a single deferred as the owner of multiple parents. For <code><a href="reference/when_all.html">when_all()</a></code> the child node is resolved once all of its parents are resolved (or one throws an error). <code><a href="reference/when_some.html">when_any()</a></code> resolves as soon as one of its parents resolves. If all of its parents throw errors then <code><a href="reference/when_some.html">when_any()</a></code> throws as well. <code><a href="reference/when_some.html">when_some()</a></code> is a generalization of <code><a href="reference/when_some.html">when_any()</a></code> and it resolves as soon as the specified number of its parents resolve without error, or if too many parents fail for <code><a href="reference/when_some.html">when_some()</a></code> to be successful.</p>
<p>When <code><a href="reference/synchronise.html">synchronise()</a></code> is called on a deferred value, the DAG rooted there is called the async DAG of the async phase. (This is usually a directed tree, and in this README we do not deal with shared deferred values, which would result more general DAGs.)</p>
<p>When the strict shared ownership model is too restrictive, certain deferred values can be marked as shared, via the <code>$share()</code> method. These can have multiple owners (children) and they are also not auto-cancelled (see Auto-Cancellation later).</p>
</div>
<div class="section level2">
<h2 id="lazy-evaluation">Lazy Evaluation<a class="anchor" aria-label="anchor" href="#lazy-evaluation"></a>
</h2>
<p>async does not evaluate deferred values that are not part of the async DAG of the async phase. These are clearly not needed to compute the result of the async phase, so it would be a waste of resources working on them. (It is also unclear how their errors should be handled.)</p>
<p>In the following example, <code>d1</code> and <code>d2</code> are created, but they are not part of the async DAG, so they are never evaluated.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">do</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">d1</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/delay.html">delay</a></span><span class="op">(</span><span class="fl">1</span><span class="op">/</span><span class="fl">100</span><span class="op">)</span><span class="op">$</span><span class="fu">then</span><span class="op">(</span><span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="st">"d1"</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">d2</span> <span class="op">&lt;-</span> <span class="va">d1</span><span class="op">$</span><span class="fu">then</span><span class="op">(</span><span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="st">"d2"</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">d3</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/delay.html">delay</a></span><span class="op">(</span><span class="fl">1</span><span class="op">/</span><span class="fl">100</span><span class="op">)</span><span class="op">$</span><span class="fu">then</span><span class="op">(</span><span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="st">"d3"</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">d4</span> <span class="op">&lt;-</span> <span class="va">d3</span><span class="op">$</span><span class="fu">then</span><span class="op">(</span><span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="st">"d4"</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">d4</span></span>
<span><span class="op">}</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/invisible.html" class="external-link">invisible</a></span><span class="op">(</span><span class="fu"><a href="reference/synchronise.html">synchronise</a></span><span class="op">(</span><span class="fu">do</span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb14"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] "d3"</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] "d4"</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="auto-cancellation">Auto-Cancellation<a class="anchor" aria-label="anchor" href="#auto-cancellation"></a>
</h2>
<p>In an async phase, it might happen that parts of the async DAG are not needed for the final result any more. E.g. if a parent of a <code><a href="reference/when_all.html">when_all()</a></code> node throws an error, then the other parents donâ€™t have to be computed. In this case the event loop of the phase automatically cancels these deferred values. Similarly, if a single parent of a <code><a href="reference/when_some.html">when_any()</a></code> node is resolved, the other parents can be cancelled.</p>
<p>In general, if a node of the async DAG is resolved, the whole directed DAG, rooted at that node, can be cancelled (except for nodes that were already resolved and nodes that have already failed).</p>
<p>Auto-cancellation is very convenient, as you can be sure that resources are free as soon as they are not needed. Some practical examples:</p>
<ul>
<li>Making HTTP requests to many mirror web sites, to check their response time. As soon as the first reply is in, the rest of the HTTP requests are cancelled.</li>
<li>In multi-process computation, as soon as one process fails, the rest are automatically cancelled. (Unless the failure is handled, of course.)</li>
</ul>
<p>async also has another type of cancellation, when <code><a href="reference/synchronise.html">synchronise()</a></code> is interrupted externally, either by the user or some system error. In this case all processes and resources that were created in the event loop, are cancelled and freed.</p>
<p>Shared deferred values (see <code>$share()</code>) are not auto-cancelled when their children are resolved or errored, but they are always cancelled at the end of the async phase.</p>
</div>
<div class="section level2">
<h2 id="async-iterators">Async Iterators<a class="anchor" aria-label="anchor" href="#async-iterators"></a>
</h2>
<p>async provides some utilities that make it easier to deal with collections of deferred values. E.g. <code><a href="reference/async_map.html">async_map()</a></code> applies an async function to a list and returns a single deferred value for the whole result. <code><a href="reference/async_detect.html">async_detect()</a></code> finds a value in a list that satisfies an async predicate function, etc.</p>
<p>The current iterators: * <code><a href="reference/async_map.html">async_map()</a></code> applies an async function to all elements of a vector or list (collection). * <code><a href="reference/async_detect.html">async_detect()</a></code> finds an element of a collection that passed an async truth test. * <code><a href="reference/async_every.html">async_every()</a></code> checks if every element of a collection satisfies an async predicate. <code><a href="reference/async_every.html">async_some()</a></code> checks if any element does that. * <code><a href="reference/async_filter.html">async_filter()</a></code> keeps elements that pass an async truth test.</p>
</div>
<div class="section level2">
<h2 id="async-control-flow">Async Control Flow<a class="anchor" aria-label="anchor" href="#async-control-flow"></a>
</h2>
<p>Control flow with deferred values can be challenging. Some helpers: * <code><a href="reference/async_reflect.html">async_reflect()</a></code> creates an async function that always succeeds. This is useful if you want to apply it to a collection, and donâ€™t want to stop at the first error. * <code><a href="reference/async_retry.html">async_retry()</a></code> tries an async function a number of times. <code><a href="reference/async_retryable.html">async_retryable()</a></code> turns a regular function into a retryable one. * <code><a href="reference/async_sequence.html">async_sequence()</a></code> chains two async functions. Calling their sequence is equivalent calling <code>then()</code> on them, but <code><a href="reference/async_sequence.html">async_sequence()</a></code> is easier to use programmatically. * <code><a href="reference/async_until.html">async_until()</a></code> and <code><a href="reference/async_whilst.html">async_whilst()</a></code> let you call an async function repeatedly, until or while a (syncronous) condition holds. * <code><a href="reference/async_timeout.html">async_timeout()</a></code> runs an async function with a timeout.</p>
</div>
<div class="section level2">
<h2 id="other-async-utilities">Other Async Utilities<a class="anchor" aria-label="anchor" href="#other-async-utilities"></a>
</h2>
<ul>
<li>
<code><a href="reference/async_constant.html">async_constant()</a></code> takes a value and creates and asynchronous function that returns that value.</li>
</ul>
</div>
<div class="section level2">
<h2 id="examples">Examples<a class="anchor" aria-label="anchor" href="#examples"></a>
</h2>
<div class="section level3">
<h3 id="parallel-api-queries">Parallel API Queries<a class="anchor" aria-label="anchor" href="#parallel-api-queries"></a>
</h3>
<p>Query the crandb API, get the authors of the packages with the most reverse dependencies.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fromJSON</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu">jsonlite</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/jsonlite/man/fromJSON.html" class="external-link">fromJSON</a></span><span class="op">(</span><span class="va">x</span>, simplifyVector <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="va">revdep_authors</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">get_author</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">package</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">url</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"https://crandb.r-pkg.org/"</span>, <span class="va">package</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="reference/http_get.html">http_get</a></span><span class="op">(</span><span class="va">url</span><span class="op">)</span><span class="op">$</span></span>
<span>      <span class="fu">then</span><span class="op">(</span><span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu">fromJSON</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rawConversion.html" class="external-link">rawToChar</a></span><span class="op">(</span><span class="va">x</span><span class="op">$</span><span class="va">content</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">$</span></span>
<span>      <span class="fu">then</span><span class="op">(</span><span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="va">x</span><span class="op">$</span><span class="va">Author</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span></span>
<span>  <span class="fu"><a href="reference/http_get.html">http_get</a></span><span class="op">(</span><span class="st">"https://crandb.r-pkg.org/-/topdeps/devel"</span><span class="op">)</span><span class="op">$</span></span>
<span>    <span class="fu">then</span><span class="op">(</span><span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu">fromJSON</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rawConversion.html" class="external-link">rawToChar</a></span><span class="op">(</span><span class="va">x</span><span class="op">$</span><span class="va">content</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">$</span></span>
<span>    <span class="fu">then</span><span class="op">(</span><span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">$</span></span>
<span>    <span class="fu">then</span><span class="op">(</span><span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="reference/async_map.html">async_map</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">get_author</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="fu"><a href="reference/synchronise.html">synchronise</a></span><span class="op">(</span><span class="fu">revdep_authors</span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">]</span></span></code></pre></div>
<div class="sourceCode" id="cb16"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [[1]]</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] "Yihui Xie [aut, cre] (&lt;https://orcid.org/0000-0003-0645-5666&gt;),\nAbhraneel Sarma [ctb],\nAdam Vogt [ctb],\nAlastair Andrew [ctb],\nAlex Zvoleff [ctb],\nAndre Simon [ctb] (the CSS files under inst/themes/ were derived from\nthe Highlight package http://www.andre-simon.de),\nAron Atkins [ctb],\nAaron Wolen [ctb],\nAshley Manton [ctb],\nAtsushi Yasumoto [ctb] (&lt;https://orcid.org/0000-0002-8335-495X&gt;),\nBen Baumer [ctb],\nBrian Diggs [ctb],\nBrian Zhang [ctb],\nBulat Yapparov [ctb],\nCassio Pereira [ctb],\nChristophe Dervieux [ctb],\nDavid Hall [ctb],\nDavid Hugh-Jones [ctb],\nDavid Robinson [ctb],\nDoug Hemken [ctb],\nDuncan Murdoch [ctb],\nElio Campitelli [ctb],\nEllis Hughes [ctb],\nEmily Riederer [ctb],\nFabian Hirschmann [ctb],\nFitch Simeon [ctb],\nForest Fang [ctb],\nFrank E Harrell Jr [ctb] (the Sweavel package at inst/misc/Sweavel.sty),\nGarrick Aden-Buie [ctb],\nGregoire Detrez [ctb],\nHadley Wickham [ctb],\nHao Zhu [ctb],\nHeewon Jeon [ctb],\nHenrik Bengtsson [ctb],\nHiroaki Yutani [ctb],\nIan Lyttle [ctb],\nHodges Daniel [ctb],\nJake Burkhead [ctb],\nJames Manton [ctb],\nJared Lander [ctb],\nJason Punyon [ctb],\nJavier Luraschi [ctb],\nJeff Arnold [ctb],\nJenny Bryan [ctb],\nJeremy Ashkenas [ctb, cph] (the CSS file at\ninst/misc/docco-classic.css),\nJeremy Stephens [ctb],\nJim Hester [ctb],\nJoe Cheng [ctb],\nJohannes Ranke [ctb],\nJohn Honaker [ctb],\nJohn Muschelli [ctb],\nJonathan Keane [ctb],\nJJ Allaire [ctb],\nJohan Toloe [ctb],\nJonathan Sidi [ctb],\nJoseph Larmarange [ctb],\nJulien Barnier [ctb],\nKaiyin Zhong [ctb],\nKamil Slowikowski [ctb],\nKarl Forner [ctb],\nKevin K. Smith [ctb],\nKirill Mueller [ctb],\nKohske Takahashi [ctb],\nLorenz Walthert [ctb],\nLucas Gallindo [ctb],\nMarius Hofert [ctb],\nMartin ModrÃ¡k [ctb],\nMichael Chirico [ctb],\nMichael Friendly [ctb],\nMichal Bojanowski [ctb],\nMichel Kuhlmann [ctb],\nMiller Patrick [ctb],\nNacho Caballero [ctb],\nNick Salkowski [ctb],\nNiels Richard Hansen [ctb],\nNoam Ross [ctb],\nObada Mahdi [ctb],\nPavel N. Krivitsky [ctb] (&lt;https://orcid.org/0000-0002-9101-3362&gt;),\nQiang Li [ctb],\nRamnath Vaidyanathan [ctb],\nRichard Cotton [ctb],\nRobert Krzyzanowski [ctb],\nRomain Francois [ctb],\nRuaridh Williamson [ctb],\nScott Kostyshak [ctb],\nSebastian Meyer [ctb],\nSietse Brouwer [ctb],\nSimon de Bernard [ctb],\nSylvain Rousseau [ctb],\nTaiyun Wei [ctb],\nThibaut Assus [ctb],\nThibaut Lamadon [ctb],\nThomas Leeper [ctb],\nTim Mastny [ctb],\nTom Torsney-Weir [ctb],\nTrevor Davis [ctb],\nViktoras Veitas [ctb],\nWeicheng Zhu [ctb],\nWush Wu [ctb],\nZachary Foster [ctb],\nZhian N. Kamvar [ctb] (&lt;https://orcid.org/0000-0003-1458-7108&gt;)"</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [[2]]</span></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] "Hadley Wickham [aut, cre],\nRStudio [cph, fnd],\nR Core team [ctb] (Implementation of utils::recover())"</span></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [[3]]</span></span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] "JJ Allaire [aut],\nYihui Xie [aut, cre] (&lt;https://orcid.org/0000-0003-0645-5666&gt;),\nJonathan McPherson [aut],\nJavier Luraschi [aut],\nKevin Ushey [aut],\nAron Atkins [aut],\nHadley Wickham [aut],\nJoe Cheng [aut],\nWinston Chang [aut],\nRichard Iannone [aut] (&lt;https://orcid.org/0000-0003-3925-190X&gt;),\nAndrew Dunning [ctb] (&lt;https://orcid.org/0000-0003-0464-5036&gt;),\nAtsushi Yasumoto [ctb, cph] (&lt;https://orcid.org/0000-0002-8335-495X&gt;,\nNumber sections Lua filter),\nBarret Schloerke [ctb],\nCarson Sievert [ctb] (&lt;https://orcid.org/0000-0002-4958-2844&gt;),\nChristophe Dervieux [ctb],\nDevon Ryan [ctb] (&lt;https://orcid.org/0000-0002-8549-0971&gt;),\nFrederik Aust [ctb] (&lt;https://orcid.org/0000-0003-4900-788X&gt;),\nJeff Allen [ctb],\nJooYoung Seo [ctb] (&lt;https://orcid.org/0000-0002-4064-6012&gt;),\nMalcolm Barrett [ctb],\nRob Hyndman [ctb],\nRomain Lesur [ctb],\nRoy Storey [ctb],\nRuben Arslan [ctb],\nSergio Oller [ctb],\nRStudio, PBC [cph],\njQuery UI contributors [ctb, cph] (jQuery UI library; authors listed in\ninst/rmd/h/jqueryui-AUTHORS.txt),\nMark Otto [ctb] (Bootstrap library),\nJacob Thornton [ctb] (Bootstrap library),\nBootstrap contributors [ctb] (Bootstrap library),\nTwitter, Inc [cph] (Bootstrap library),\nAlexander Farkas [ctb, cph] (html5shiv library),\nScott Jehl [ctb, cph] (Respond.js library),\nIvan Sagalaev [ctb, cph] (highlight.js library),\nGreg Franko [ctb, cph] (tocify library),\nJohn MacFarlane [ctb, cph] (Pandoc templates),\nGoogle, Inc. [ctb, cph] (ioslides library),\nDave Raggett [ctb] (slidy library),\nW3C [cph] (slidy library),\nDave Gandy [ctb, cph] (Font-Awesome),\nBen Sperry [ctb] (Ionicons),\nDrifty [cph] (Ionicons),\nAidan Lister [ctb, cph] (jQuery StickyTabs),\nBenct Philip Jonsson [ctb, cph] (pagebreak Lua filter),\nAlbert Krewinkel [ctb, cph] (pagebreak Lua filter)"</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="checking-urls">Checking URLs<a class="anchor" aria-label="anchor" href="#checking-urls"></a>
</h3>
<p>The following code returns the 2 URLs that respond with the shortest response time.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">response_time</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/async.html">async</a></span><span class="op">(</span><span class="kw">function</span><span class="op">(</span><span class="va">url</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="reference/http_head.html">http_head</a></span><span class="op">(</span><span class="va">url</span><span class="op">)</span><span class="op">$</span></span>
<span>    <span class="fu">then</span><span class="op">(</span><span class="va">http_stop_for_status</span><span class="op">)</span><span class="op">$</span></span>
<span>    <span class="fu">then</span><span class="op">(</span><span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/stats/setNames.html" class="external-link">setNames</a></span><span class="op">(</span><span class="va">x</span><span class="op">[[</span><span class="st">"times"</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="st">"total"</span><span class="op">]</span><span class="op">]</span>, <span class="va">url</span><span class="op">)</span><span class="op">)</span><span class="op">$</span></span>
<span>    <span class="fu">catch</span><span class="op">(</span>error <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/stats/setNames.html" class="external-link">setNames</a></span><span class="op">(</span><span class="cn">Inf</span>, <span class="va">url</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span></span>
<span><span class="va">fastest_urls</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/async.html">async</a></span><span class="op">(</span><span class="kw">function</span><span class="op">(</span><span class="va">urls</span>, <span class="va">n</span> <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">reqs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">urls</span>, <span class="va">response_time</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="reference/when_some.html">when_some</a></span><span class="op">(</span><span class="va">n</span>, .list <span class="op">=</span> <span class="va">reqs</span><span class="op">)</span><span class="op">$</span></span>
<span>    <span class="fu">then</span><span class="op">(</span><span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/sort.html" class="external-link">sort</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span></span>
<span><span class="va">urls</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"https://cran.rstudio.com"</span>, <span class="st">"https://cran.r-project.org"</span>,</span>
<span>          <span class="st">"https://www.stats.bris.ac.uk/R/"</span>, <span class="st">"https://cran.uib.no/"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="reference/synchronise.html">synchronise</a></span><span class="op">(</span><span class="fu">fastest_urls</span><span class="op">(</span><span class="va">urls</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb18"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   https://cran.rstudio.com https://cran.r-project.org </span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;                   0.057224                   0.174976</span></span></code></pre></div>
<p>See the package vignettes for more examples.</p>
</div>
</div>
<div class="section level2">
<h2 id="license">License<a class="anchor" aria-label="anchor" href="#license"></a>
</h2>
<p>MIT Â© <a href="https://rstudio.com" class="external-link">RStudio Inc</a></p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <div class="links">
<h2 data-toc-skip>Links</h2>
<ul class="list-unstyled">
<li><a href="https://cloud.r-project.org/package=async" class="external-link">View on CRAN</a></li>
<li><a href="https://github.com/gaborcsardi/async/" class="external-link">Browse source code</a></li>
<li><a href="https://github.com/gaborcsardi/async/issues" class="external-link">Report a bug</a></li>
</ul>
</div>

<div class="license">
<h2 data-toc-skip>License</h2>
<ul class="list-unstyled">
<li>
<a href="https://opensource.org/licenses/mit-license.php" class="external-link">MIT</a> + file <a href="LICENSE-text.html">LICENSE</a>
</li>
</ul>
</div>


<div class="citation">
<h2 data-toc-skip>Citation</h2>
<ul class="list-unstyled">
<li><a href="authors.html#citation">Citing async</a></li>
</ul>
</div>

<div class="developers">
<h2 data-toc-skip>Developers</h2>
<ul class="list-unstyled">
<li>GÃ¡bor CsÃ¡rdi <br><small class="roles"> Maintainer </small>  </li>
</ul>
</div>

<div class="dev-status">
<h2 data-toc-skip>Dev status</h2>
<ul class="list-unstyled">
<li><a href="https://app.codecov.io/gh/gaborcsardi/async?branch=main" class="external-link"><img src="https://codecov.io/gh/gaborcsardi/async/branch/main/graph/badge.svg" alt="Codecov test coverage"></a></li>
<li><a href="https://github.com/gaborcsardi/async/actions/workflows/R-CMD-check.yaml" class="external-link"><img src="https://github.com/gaborcsardi/async/actions/workflows/R-CMD-check.yaml/badge.svg" alt="R-CMD-check"></a></li>
</ul>
</div>

  </div>
</div>


      <footer><div class="copyright">
  <p></p>
<p>Developed by GÃ¡bor CsÃ¡rdi.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
