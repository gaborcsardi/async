<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Repeated timer — async_timer • async</title><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Repeated timer — async_timer"><meta property="og:description" content="The supplied callback function will be called by the event loop
every delay seconds."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">async</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.0.0.9004</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu"><li>
      <a href="../articles/async-example.html">Examples for the async package</a>
    </li>
    <li>
      <a href="../articles/internals.html">Internals of the async package</a>
    </li>
  </ul></li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://github.com/gaborcsardi/async/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Repeated timer</h1>
    <small class="dont-index">Source: <a href="https://github.com/gaborcsardi/async/blob/HEAD/R/timer.R" class="external-link"><code>R/timer.R</code></a></small>
    <div class="hidden name"><code>async_timer.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>The supplied callback function will be called by the event loop
every <code>delay</code> seconds.</p>
    </div>


    <div id="usage">
    <h2>Usage</h2>
    


<p></p><div class="sourceCode"><pre><code><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>t <span class="ot">&lt;-</span> async_timer<span class="sc">$</span><span class="fu">new</span>(delay, callback)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>t<span class="sc">$</span><span class="fu">cancel</span>()</span></code></pre><p></p></div>
    </div>
    <div id="arguments">
    <h2>Arguments</h2>
    

<ul><li><p><code>delay</code>: Time interval in seconds, the amount of time to delay
to delay the execution. It can be a fraction of a second.</p></li>
<li><p><code>callback</code>: Callback function without arguments. It will be called
from the event loop every <code>delay</code> seconds.</p></li>
</ul></div>
    <div id="details">
    <h2>Details</h2>
    


<p>An <code>async_timer</code> is an <code>[event_emitter]</code> object with a <code>timeout</code> event.
It is possible to add multiple listeners to this event, once the timer
is created. Note, however, that removing all listeners does not cancel
the timer, <code>timeout</code> events will be still emitted as usual.
For proper cancellation you'll need to call the <code>cancel()</code> method.</p>
<p>It is only possible to create <code>async_timer</code> objects in an asynchronous
context, i.e. within a <code><a href="synchronise.html">synchronise()</a></code> or <code><a href="run_event_loop.html">run_event_loop()</a></code> call.
A <code><a href="synchronise.html">synchronise()</a></code> call finishes as soon as its returned deferred value
is resolved (or rejected), even if some timers are still active. The
active timers will be automatically cancelled in this case.</p>
    </div>
    <div id="errors">
    <h2>Errors</h2>
    

<p>Errors are handled the same way as for generic event emitters. I.e. to
catch errors thrown in the <code>callback</code> function, you need to add a
listener to the <code>error</code> event, see the example below.</p>
    </div>
    <div id="congestion">
    <h2>Congestion</h2>
    

<p><code>async_timer</code> is <em>not</em> a real-time timer. In particular, if <code>callback</code>
does not return in time, before the next timer event, then all future
timer events will be delayed. Even if <code>callback</code> returns promptly, the
event loop might be busy with other events, and then the next timer
event is not emitted in time. In general there is no guarantee about
the timing of the timer events.</p>
    </div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co">## Call 10 times a second, cancel with 1/10 probability</span></span></span>
<span class="r-in"><span><span class="va">counter</span> <span class="op">&lt;-</span> <span class="fl">0L</span></span></span>
<span class="r-in"><span><span class="va">do</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>  <span class="va">cb</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>    <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"called\n"</span><span class="op">)</span></span></span>
<span class="r-in"><span>    <span class="va">counter</span> <span class="op">&lt;&lt;-</span> <span class="va">counter</span> <span class="op">+</span> <span class="fl">1L</span></span></span>
<span class="r-in"><span>    <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span> <span class="op">&lt;</span> <span class="fl">0.1</span><span class="op">)</span> <span class="va">t</span><span class="op">$</span><span class="fu">cancel</span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="op">}</span></span></span>
<span class="r-in"><span>  <span class="va">t</span> <span class="op">&lt;-</span> <span class="va">async_timer</span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="fl">1</span><span class="op">/</span><span class="fl">10</span>, <span class="va">cb</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu"><a href="run_event_loop.html">run_event_loop</a></span><span class="op">(</span><span class="fu">do</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> called</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> called</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> called</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> called</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> called</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> called</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> called</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> called</span>
<span class="r-in"><span><span class="va">counter</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 8</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Error handling</span></span></span>
<span class="r-in"><span><span class="va">counter</span> <span class="op">&lt;-</span> <span class="fl">0L</span></span></span>
<span class="r-in"><span><span class="va">do</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>  <span class="va">cb</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>    <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"called\n"</span><span class="op">)</span></span></span>
<span class="r-in"><span>    <span class="va">counter</span> <span class="op">&lt;&lt;-</span> <span class="va">counter</span> <span class="op">+</span> <span class="fl">1L</span></span></span>
<span class="r-in"><span>    <span class="kw">if</span> <span class="op">(</span><span class="va">counter</span> <span class="op">==</span> <span class="fl">2L</span><span class="op">)</span> <span class="kw"><a href="https://rdrr.io/r/base/stop.html" class="external-link">stop</a></span><span class="op">(</span><span class="st">"foobar"</span><span class="op">)</span></span></span>
<span class="r-in"><span>    <span class="kw">if</span> <span class="op">(</span><span class="va">counter</span> <span class="op">==</span> <span class="fl">3L</span><span class="op">)</span> <span class="va">t</span><span class="op">$</span><span class="fu">cancel</span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="op">}</span></span></span>
<span class="r-in"><span>  <span class="va">t</span> <span class="op">&lt;-</span> <span class="va">async_timer</span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="fl">1</span><span class="op">/</span><span class="fl">10</span>, <span class="va">cb</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="va">handler</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">err</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>    <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Got error:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/sQuote.html" class="external-link">sQuote</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/conditions.html" class="external-link">conditionMessage</a></span><span class="op">(</span><span class="va">err</span><span class="op">)</span><span class="op">)</span>, <span class="st">", handled\n"</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="op">}</span></span></span>
<span class="r-in"><span>  <span class="va">t</span><span class="op">$</span><span class="fu">listen_on</span><span class="op">(</span><span class="st">"error"</span>, <span class="va">handler</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu"><a href="run_event_loop.html">run_event_loop</a></span><span class="op">(</span><span class="fu">do</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> called</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> called</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Got error: ‘foobar’ , handled</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> called</span>
<span class="r-in"><span><span class="va">counter</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 3</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Error handling at the synchonization point</span></span></span>
<span class="r-in"><span><span class="va">counter</span> <span class="op">&lt;-</span> <span class="fl">0L</span></span></span>
<span class="r-in"><span><span class="va">do</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>  <span class="va">cb</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>    <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"called\n"</span><span class="op">)</span></span></span>
<span class="r-in"><span>    <span class="va">counter</span> <span class="op">&lt;&lt;-</span> <span class="va">counter</span> <span class="op">+</span> <span class="fl">1L</span></span></span>
<span class="r-in"><span>    <span class="kw">if</span> <span class="op">(</span><span class="va">counter</span> <span class="op">==</span> <span class="fl">2L</span><span class="op">)</span> <span class="kw"><a href="https://rdrr.io/r/base/stop.html" class="external-link">stop</a></span><span class="op">(</span><span class="st">"foobar"</span><span class="op">)</span></span></span>
<span class="r-in"><span>    <span class="kw">if</span> <span class="op">(</span><span class="va">counter</span> <span class="op">==</span> <span class="fl">3L</span><span class="op">)</span> <span class="va">t</span><span class="op">$</span><span class="fu">cancel</span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="op">}</span></span></span>
<span class="r-in"><span>  <span class="va">t</span> <span class="op">&lt;-</span> <span class="va">async_timer</span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="fl">1</span><span class="op">/</span><span class="fl">10</span>, <span class="va">cb</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/conditions.html" class="external-link">tryCatch</a></span><span class="op">(</span><span class="fu"><a href="run_event_loop.html">run_event_loop</a></span><span class="op">(</span><span class="fu">do</span><span class="op">(</span><span class="op">)</span><span class="op">)</span>, error <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="va">x</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> called</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> called</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &lt;simpleError in lst$cb(...): foobar&gt;</span>
<span class="r-in"><span><span class="va">counter</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 2</span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Gábor Csárdi.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.5.</p>
</div>

      </footer></div>

  


  

  </body></html>

